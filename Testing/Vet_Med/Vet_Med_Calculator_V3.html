<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>VetMed SafeCalc 2026</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
    --primary:#2c7a7b;
    --secondary:#e6fffa;
    --warning:#c05621;
    --error:#e53e3e;
    --text:#2d3748;
}
body{
    font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    background:#f7fafc;
    color:var(--text);
    max-width:950px;
    margin:auto;
    padding:20px;
}
h1{text-align:center;color:var(--primary);}
.tabs{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-bottom:20px;}
.tab-btn{padding:10px 18px;border:none;background:#e2e8f0;border-radius:5px;font-weight:600;cursor:pointer;}
.tab-btn.active{background:var(--primary);color:white;}
.calc-section{display:none;background:white;padding:25px;border-radius:8px;box-shadow:0 4px 6px rgba(0,0,0,.05);}
.calc-section.active{display:block;}
.input-group{margin-bottom:15px;}
label{font-weight:600;font-size:.9em;display:block;margin-bottom:5px;}
input,select{width:100%;padding:10px;border:1px solid #cbd5e0;border-radius:4px;}
button.calculate{width:100%;padding:12px;background:var(--primary);color:white;border:none;border-radius:4px;font-size:1.05em;cursor:pointer;}
.result-box{display:none;margin-top:20px;padding:15px;background:var(--secondary);border-left:5px solid var(--primary);}
.warning-box{display:none;margin-top:10px;padding:10px;background:#fffaf0;border-left:5px solid var(--warning);color:var(--warning);}
.alert-box{display:none;margin-top:10px;padding:10px;background:#fff5f5;border-left:5px solid var(--error);color:var(--error);}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:15px;}
hr{border:none;border-top:1px solid #ccc;margin:12px 0;}

@media print{
    body{background:white;max-width:100%;}
    .tabs,.calculate{display:none;}
    .calc-section{box-shadow:none;border:none;}
}
</style>
</head>

<body>

<h1>üêæ VetMed SafeCalc</h1>

<div class="tabs">
    <button class="tab-btn active" onclick="showTab('dosage')">Dosage</button>
    <button class="tab-btn" onclick="showTab('dilution')">Dilution</button>
    <button class="tab-btn" onclick="showTab('fluids')">CRI</button>
    <button class="tab-btn" onclick="showTab('metabolic')">RER & BSA</button>
    <button class="tab-btn" onclick="showTab('print')">Anesthesia Sheet</button>
</div>

<!-- ================= DOSAGE ================= -->
<div id="dosage" class="calc-section active">
<h2>üíä Medication Dosage</h2>

<div class="grid-2">
    <div class="input-group">
        <label>Species</label>
        <select id="species">
            <option value="dog">Dog</option>
            <option value="cat">Cat</option>
        </select>
    </div>
    <div class="input-group">
        <label>Weight</label>
        <input type="number" id="weight" step="0.01">
    </div>
</div>

<div class="input-group">
    <label>Weight Unit</label>
    <select id="weight_unit">
        <option value="kg">kg</option>
        <option value="lb">lb</option>
    </select>
</div>

<div class="input-group">
    <label>Drug</label>
    <select id="drug" onchange="applyDrug()">
        <option value="">‚Äî select ‚Äî</option>
        <option value="fentanyl">Fentanyl</option>
        <option value="dexmed">Dexmedetomidine</option>
        <option value="hydromorphone">Hydromorphone</option>
    </select>
</div>

<div class="grid-2">
    <div class="input-group">
        <label>Dose Rate</label>
        <input type="number" id="dose_rate" step="0.000001">
    </div>
    <div class="input-group">
        <label>Dose Units</label>
        <select id="dose_units">
            <option value="mcg/kg">mcg/kg</option>
            <option value="ng/kg">ng/kg</option>
            <option value="mg/kg">mg/kg</option>
            <option value="mcg/lb">mcg/lb</option>
            <option value="ng/lb">ng/lb</option>
            <option value="mg/lb">mg/lb</option>
        </select>
    </div>
</div>

<div class="input-group">
    <label>Concentration (mg/mL)</label>
    <input type="number" id="conc" step="0.0001">
</div>

<button class="calculate" onclick="calcDose()">Calculate</button>

<div id="dose_result" class="result-box"></div>
<div id="dose_warn" class="warning-box"></div>
<div id="dilution_auto" class="alert-box"></div>
</div>

<!-- ================= DILUTION ================= -->
<div id="dilution" class="calc-section">
<h2>üíß Dilution (C1V1 = C2V2)</h2>
<p>Leave exactly one field blank.</p>

<div class="grid-2">
    <input type="number" id="dil_c1" placeholder="C1">
    <input type="number" id="dil_v1" placeholder="V1 (mL)">
    <input type="number" id="dil_c2" placeholder="C2">
    <input type="number" id="dil_v2" placeholder="V2 (mL)">
</div>

<button class="calculate" onclick="calcDilution()">Calculate</button>
<div id="dil_result" class="result-box"></div>
</div>

<!-- ================= CRI ================= -->
<div id="fluids" class="calc-section">
<h2>üåä CRI Calculator</h2>

<div class="grid-2">
    <input type="number" id="cri_weight" placeholder="Weight (kg)">
    <input type="number" id="cri_dose" placeholder="Dose (ng or mcg/kg/min)">
</div>

<div class="input-group">
    <label>Drug Concentration (mg/mL)</label>
    <input type="number" id="cri_conc">
</div>

<button class="calculate" onclick="calcCRI()">Calculate CRI</button>
<div id="cri_result" class="result-box"></div>
</div>

<!-- ================= METABOLIC ================= -->
<div id="metabolic" class="calc-section">
<h2>‚ö° RER & BSA</h2>

<div class="grid-2">
    <input type="number" id="meta_weight" placeholder="Weight (kg)">
    <select id="meta_species">
        <option value="dog">Dog</option>
        <option value="cat">Cat</option>
    </select>
</div>

<button class="calculate" onclick="calcMetabolic()">Calculate</button>
<div id="meta_result" class="result-box"></div>
</div>

<!-- ================= PRINT ================= -->
<div id="print" class="calc-section">
<h2>üñ®Ô∏è Printable Anesthesia Sheet</h2>

<div class="result-box" style="display:block;">
    <strong>Species:</strong> <span id="p_species"></span><br>
    <strong>Weight:</strong> <span id="p_weight"></span><br>
    <strong>Drug:</strong> <span id="p_drug"></span><br>
    <strong>Dose:</strong> <span id="p_dose"></span><br>
    <strong>Volume:</strong> <span id="p_volume"></span><br>
    <strong>Notes:</strong> Double-check all calculations independently.
</div>

<button class="calculate" onclick="window.print()">Print Sheet</button>
</div>

<script>
/* ---------- CONSTANTS ---------- */
const MASS={ng:1e-6,mcg:1e-3,mg:1};
const WT={kg:1,lb:0.453592};

const PRESETS={
    fentanyl:{units:"mcg/kg",conc:0.05},
    dexmed:{units:"mcg/kg",conc:0.5},
    hydromorphone:{units:"mg/kg",conc:2}
};

const LIMITS={
    fentanyl:{dog:10,cat:5},
    dexmed:{dog:20,cat:10},
    hydromorphone:{dog:0.2,cat:0.1}
};

/* ---------- NAV ---------- */
function showTab(id){
    document.querySelectorAll('.calc-section').forEach(s=>s.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    event.target.classList.add('active');
}

/* ---------- DOSAGE ---------- */
function applyDrug(){
    if(PRESETS[drug.value]){
        dose_units.value=PRESETS[drug.value].units;
        conc.value=PRESETS[drug.value].conc;
    }
}

function calcDose(){
    const sp=species.value;
    const w=+weight.value*WT[weight_unit.value];
    const rate=+dose_rate.value;
    const [mu]=dose_units.value.split('/');
    const c=+conc.value;

    const res=dose_result,warn=dose_warn,auto=dilution_auto;
    warn.style.display=auto.style.display="none";

    if(!w||!rate||!c){res.style.display='block';res.innerHTML="Fill all fields.";return;}

    const totalMg=w*rate*MASS[mu];
    const vol=totalMg/c;

    res.style.display='block';
    res.innerHTML=`Total Drug: ${totalMg.toFixed(6)} mg<br>
                   Volume: <strong>${vol.toFixed(4)} mL</strong>`;

    if(LIMITS[drug.value] && rate>LIMITS[drug.value][sp]){
        warn.style.display='block';
        warn.innerHTML="‚ö†Ô∏è Exceeds typical species upper bound.";
    }

    if(vol<0.05){
        const target=0.1;
        auto.style.display='block';
        auto.innerHTML=
            `‚ö†Ô∏è Micro-volume detected.<br>
             Suggested dilution to ${target} mL total.<br>
             New concentration: ${(totalMg/target).toFixed(4)} mg/mL`;
    }

    p_species.textContent=sp;
    p_weight.textContent=weight.value+" "+weight_unit.value;
    p_drug.textContent=drug.value||"‚Äî";
    p_dose.textContent=rate+" "+dose_units.value;
    p_volume.textContent=vol.toFixed(4)+" mL";
}

/* ---------- DILUTION ---------- */
function calcDilution(){
    const c1=+dil_c1.value,v1=+dil_v1.value,c2=+dil_c2.value,v2=+dil_v2.value;
    const arr=[c1,v1,c2,v2];
    if(arr.filter(x=>!x).length!==1){
        dil_result.style.display='block';
        dil_result.innerHTML="Fill exactly 3 fields.";
        return;
    }
    let msg="";
    if(!v2) msg=`V2 = ${(c1*v1/c2).toFixed(2)} mL`;
    else if(!c2) msg=`C2 = ${(c1*v1/v2).toFixed(2)}`;
    else if(!v1) msg=`V1 = ${(c2*v2/c1).toFixed(2)} mL`;
    else msg=`C1 = ${(c2*v2/v1).toFixed(2)}`;
    dil_result.style.display='block';
    dil_result.innerHTML=msg;
}

/* ---------- CRI ---------- */
function calcCRI(){
    const w=+cri_weight.value,d=+cri_dose.value,c=+cri_conc.value;
    if(!w||!d||!c){cri_result.style.display='block';cri_result.innerHTML="Fill all fields.";return;}
    const mgkgHr=d<1?(d*60)/1e6:(d*60)/1000;
    const mlHr=(mgkgHr*w)/c;
    cri_result.style.display='block';
    cri_result.innerHTML=`CRI Rate: <strong>${mlHr.toFixed(3)} mL/hr</strong>`;
}

/* ---------- METABOLIC ---------- */
function calcMetabolic(){
    const w=+meta_weight.value;
    if(!w) return;
    const rer=70*Math.pow(w,.75);
    const k=meta_species.value==="dog"?10.1:10;
    const bsa=(k*Math.pow(w*1000,2/3))/10000;
    meta_result.style.display='block';
    meta_result.innerHTML=
        `RER: ${rer.toFixed(0)} kcal/day<br>
         Maintenance (1.2√ó): ${(rer*1.2).toFixed(0)} kcal/day<br>
         BSA: ${bsa.toFixed(3)} m¬≤`;
}
</script>

</body>
</html>
